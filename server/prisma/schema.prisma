// prisma/schema.prisma

// ---------------------
// Generator & Datasource
// ---------------------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------------------
// Enums
// ---------------------
enum Role {
  ADMIN
  DONOR
  TIER_ONE
  TIER_TWO
  TIER_THREE
}

// User account status for approval/workflow
enum UserStatus {
  PENDING
  ACTIVE
  SUSPENDED
}

// ---------------------
// Models
// ---------------------
model Donor {
  id           Int     @id @default(autoincrement())
  firstName    String  @db.VarChar(50)
  lastName     String  @db.VarChar(50)
  contact      String? @db.VarChar(10)
  email        String  @db.VarChar(100) @unique
  addressLine1 String? @db.VarChar(50)
  addressLine2 String? @db.VarChar(50)
  state        String? @db.VarChar(15)
  city         String? @db.VarChar(15)
  zipcode      String  @db.VarChar(20)
  emailOptIn   Boolean

  donatedItems DonatedItem[]
}

model Program {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(100)
  description  String        @db.VarChar(500)
  startDate    DateTime      @db.Date
  aimAndCause  String        @db.VarChar(500)

  donatedItems DonatedItem[]
}

model DonatedItem {
  id              Int                 @id @default(autoincrement())

  // Core item info
  itemType        String              @db.VarChar(50)   // e.g., "Chair", "Laptop"
  category        String                                  // your higher-level category
  quantity        Int
  currentStatus   String              @db.VarChar(20)   // e.g., "Received", "Processed"

  // Timestamps
  dateDonated     DateTime
  lastUpdated     DateTime            @updatedAt

  // Media & analysis
  imagePath       String?
  analysisMetadata Json?                                 // <â€” where your code writes tags/metadata

  // Relations
  donorId         Int
  donor           Donor               @relation(fields: [donorId], references: [id])

  programId       Int?
  program         Program?            @relation(fields: [programId], references: [id])

  statuses        DonatedItemStatus[]

  @@index([donorId])
  @@index([programId])
}

model DonatedItemStatus {
  id            Int         @id @default(autoincrement())
  dateModified  DateTime
  statusType    String      @db.VarChar(20)

  donatedItemId Int
  donatedItem   DonatedItem @relation(fields: [donatedItemId], references: [id], onDelete: Cascade)

  imageUrls     String[]

  @@index([donatedItemId])
}

model User {
  id               String   @id @default(uuid())
  name             String
  email            String   @unique
  password         String
  role             Role?
  status           UserStatus @default(PENDING)
  createdAt        DateTime @default(now())
  firstLogin       Boolean  @default(true)
  resetToken       String?
  resetTokenExpiry DateTime?
}